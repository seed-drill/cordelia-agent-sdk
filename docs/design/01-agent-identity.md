# Design: Agent Identity

## Motivation

Cordelia's primitives (groups, memories, trust) all operate on entities. Agents need first-class entity status to participate. Rather than creating a parallel system, agents should use the same identity infrastructure as humans.

## Design

### Identity = Ed25519 Keypair

Every agent gets an Ed25519 keypair generated by the node at registration. The `agent_id` is the SHA-256 hash of the public key, identical to how `node_id` works in the P2P layer. This means agents can authenticate via signature, participate in replication, and be verified across nodes.

### Agent-Entity Equivalence

```
entity_id = agent_id = SHA-256(Ed25519_pubkey)
```

Any Cordelia operation that takes `entity_id` accepts `agent_id`. No special cases, no type switches, no conditional logic. This is not syntactic sugar -- it is a fundamental design choice.

### Parent Chain

Every agent has a `parent_entity_id`. This creates a directed tree:

```
Human Entity (root)
  +-- Claude Code Agent A
  |     +-- Swarm Worker A1
  |     +-- Swarm Worker A2
  +-- Claude Code Agent B
```

Parent chain is used for:
- Capability inheritance (child <= parent)
- Trust propagation (new child starts with parent's trust context)
- Lifecycle control (parent can deactivate child)

### Registration Flow

```
Parent -> agent_register -> Node
  Node: generate Ed25519 keypair
  Node: agent_id = SHA-256(pubkey)
  Node: create L1 entry (user_id = agent_id)
  Node: store in agents table
  Node: encrypt private key with parent's key
Node -> { agent_id, pubkey, encrypted_privkey } -> Parent
```

## Security Considerations

- Private keys encrypted at rest with parent's key
- Agent cannot escalate its own capabilities
- Deactivated agents' keys are invalidated (signature verification fails)
- Parent chain is immutable -- cannot reassign parent

## Open Questions

1. Should agents be able to spawn sub-agents? (Current answer: yes, subject to capability inheritance)
2. Maximum parent chain depth? (Proposed: 8, to prevent unbounded delegation)
3. Key rotation for long-lived autonomous agents?
